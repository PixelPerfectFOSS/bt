{"version":3,"file":"animation.js","sources":["../src/helpers/selector.js","../src/main/dom.js","../src/main/capture.js","../src/main/global.js","../src/main/stop.js","../src/main/frame.js","../src/banner.js"],"sourcesContent":["export function $(query) {\n\tconst nodes = document.querySelectorAll(query);\n\tif (nodes.length === 1) return nodes[0];\n\treturn nodes;\n}\n\nexport function id(value) {\n\treturn document.getElementById(value);\n}\n\nexport default $;\n","// Сгенерировано, не лезь!\n\nimport { $, id } from \"../helpers/selector\";\nexport default $;\n\nexport const link = id(\"link\");\nexport const container = id(\"container\");\nexport const overlay = id(\"overlay\");","export function capture(duration, delay, options) {\r\n\tif (window._capture !== undefined) window._capture({ tl: this, delay, duration, options });\r\n}\r\n\r\nexport function detectCapturing() {\r\n\treturn (window._capture !== undefined);\r\n}\r\n","import { container } from \"./dom\";\r\nimport { detectCapturing } from \"./capture\";\r\n\r\nexport const master = gsap.timeline({ id: \"MASTER\", repeat: -1, paused: true });\r\n\r\nexport const banner = {\r\n};\r\n\r\nlet isLoaded = false;\r\nexport let isCapturing;\r\n\r\nwindow.addEventListener(\"load\", () => {\r\n\tisLoaded = true;\r\n\tisCapturing = detectCapturing();\r\n});\r\n\r\nlet opened;\r\n\r\nexport let isBannerReady = false;\r\n\r\nexport let bannerW;\r\nexport let bannerH;\r\nexport let halfW;\r\nexport let halfH;\r\nexport let ratio;\r\n\r\nexport function open() {\r\n\topened = true;\r\n}\r\n\r\nexport function close() {\r\n\topened = false;\r\n}\r\n\r\nexport const bannerReadyChecks = [\r\n\t() => opened === true,\r\n\t() => isLoaded === true || document.readyState === \"complete\",\r\n\t() => bannerW > 0 && bannerH > 0 && window.innerWidth > 0 && window.innerHeight > 0,\r\n];\r\n\r\nexport function update() {\r\n\tbannerW = container.offsetWidth;\r\n\tbannerH = container.offsetHeight;\r\n\thalfW = bannerW * 0.5;\r\n\thalfH = bannerH * 0.5;\r\n\tratio = bannerW / bannerH;\r\n\tisBannerReady = bannerReadyChecks.every(func => func() === true);\r\n}\r\n","import { master, banner } from \"./global\";\r\n\r\nlet isFirst = true;\r\nlet isStopAdded = false;\r\nlet isPaused = false;\r\nlet loops = 0;\r\n\r\nexport function stop(delay = \"+=0.0\", timeline) {\r\n\tif (isStopAdded === true && isFirst === true) {\r\n\t\talert(\"More than one tl.stop() call found\");\r\n\t\treturn;\r\n\t}\r\n\r\n\tisStopAdded = true;\r\n\tisFirst = false;\r\n\tconst tl = (timeline !== undefined) ? timeline : this;\r\n\r\n\tfunction checkStop() {\r\n\t\tif (isPaused || master.paused()) {\r\n\t\t\tbanner.timeLimit = 0;\r\n\t\t\tisPaused = true;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tconst stopLabel = (tl.labels[\"@stop\"] !== undefined) ? tl.labels[\"@stop\"] : tl.labels[\"_@stop\"];\r\n\t\tconst stopTime = tl.startTime() + stopLabel;\r\n\t\t\r\n\t\tif (banner.timeLimit > 0) {\r\n\t\t\tconst oneLoopTime = master.duration() + master.repeatDelay();\r\n\t\t\tconst currentTime = master.time() + oneLoopTime * loops;\r\n\t\t\t\r\n\t\t\tif (currentTime > banner.timeLimit) {\r\n\t\t\t\talert(\"Animation exceeds banner.timeLimit: \" + currentTime + \"s / \" + banner.timeLimit + \"s\");\r\n\t\t\t}\r\n\r\n\t\t\tif ((currentTime + oneLoopTime) > banner.timeLimit){\r\n\t\t\t\tmaster.pause(stopTime, true);\r\n\t\t\t\tconsole.log(\"Stopped at \" + currentTime + \"s\");\r\n\t\t\t\tisPaused = true;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tloops += 1;\r\n\t}\r\n\r\n\ttl.addLabel(\"_@stop\", delay);\r\n\ttl.add(checkStop, \"_@stop\");\r\n}\r\n\r\nexport function checkStops() {\r\n\tif (banner.timeLimit > 0) {\r\n\t\tif (isStopAdded === false) {\r\n\t\t\talert(\"No tl.stop() found\");\r\n\t\t}\r\n\t\tif (master.duration() > banner.timeLimit){\r\n\t\t\talert(\"Animation loop exceeds banner.timeLimit\");\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport function resetStop() {\r\n\tisPaused = false;\r\n\tloops = 0;\r\n}\r\n","import { stop } from \"./stop\";\r\nimport { capture } from \"./capture\";\r\n\r\nexport function frame(tlFunc, gsapOptions = {}) {\r\n\tgsapOptions.id = tlFunc.name;\r\n\tconst tl = gsap.timeline(gsapOptions);\r\n\ttl.stop = stop;\r\n\ttl.capture = capture;\r\n\ttlFunc(tl);\r\n\treturn tl;\r\n}\r\n","import { master, banner } from \"./main/global\";\nimport * as global from \"./main/global\";\nimport { bannerW, bannerH, halfW, halfH, ratio } from \"./main/global\";\nimport select, { container } from \"./main/dom\";\nimport * as $ from \"./main/dom\";\nimport { frame } from \"./main/frame\";\nimport { stop, checkStops, resetStop } from \"./main/stop\";\nimport { capture } from \"./main/capture\";\nimport \"./banner.sass\";\n\nbanner.timeLimit = 0;\n\nfunction createAnimation(tl) {\n\ttl.add(frame(opening, {}), \"+=0.0\");\n}\n\nfunction opening(tl) {\n\ttl.addLabel(\"start\", 0.0);\n\n\t//tl.capture(2.5, \"+=0.0\");\n\t//tl.stop(\"+=0.0\");\n\t//if (global.isCapturing)\n}\n\nif (window.onload === null) window.onload = open;\n\nfunction open() {\n\tif (window.blocked === true) return;\n\tglobal.open();\n\t//\n\tstart();\n}\n\nfunction start() {\n\tconsole.info(\"start\");\n\tresize();\n\tif (!global.isBannerReady) return gsap.delayedCall(0.02, start);\n\n\tcontainer.style.opacity = \"1\";\n\t\n\twindow.onresize = function() { resize(); };\n\t\n\tmaster.clear();\n\tcreateAnimation(master);\n\tmaster.play(0);\n\n\tcheckStops();\n}\n\nfunction close() {\n\tcontainer.style.opacity = \"0\";\n\twindow.onresize = null;\n\tmaster.pause(0);\n\tglobal.close();\n}\n\nfunction replay() {\n\tresetStop();\n\tstart();\n}\n\nfunction resize() {\n\tglobal.update();\n\tif (!global.isBannerReady) return;\n\t//\n}\n\ngsap.defaults({\n\tease: \"linear\"\n});\n\nexport default {\n\tmaster,\n\topen,\n\t// close,\n\treplay,\n\tinfo: { type: \"gsap\", version: 2 },\n};\n"],"names":["banner","open","global.open","global.isBannerReady","global.update"],"mappings":"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"}